<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru">
<body>

<div th:fragment="ratingsList" class="ratings-container">
    <div th:if="${error}" class="alert alert-danger">
        <span th:text="${error}"></span>
    </div>

    <div th:unless="${error}">
        <div th:if="${ratings == null || ratings.empty}">
            <div class="no-ratings text-center py-5">
                <i class="bi bi-star text-muted" style="font-size: 3rem;"></i>
                <h5 class="mt-3">У этой викторины пока нет оценок</h5>
                <p class="text-muted">Будьте первым, кто оставит отзыв!</p>
            </div>
        </div>

        <div th:if="${ratings != null && !ratings.empty}">
            <div th:each="rating : ${ratings}" class="rating-item mb-4">
                <div class="rating-header d-flex justify-content-between align-items-start">
                    <div class="rating-user">
                        <img th:src="@{${rating.user.avatarUrl != null ? rating.user.avatarUrl : '/images/default-avatar.png'}}"
                             alt="User" class="user-avatar-sm">
                        <div class="user-info">
                            <div class="user-name"
                                 th:text="${rating.user.name != null ? rating.user.name : rating.user.username}"></div>
                            <small class="text-muted"
                                   th:text="${#temporals.format(rating.createdAt, 'dd.MM.yyyy HH:mm')}"></small>
                        </div>
                    </div>
                    <div class="rating-stars">
                        <div class="stars">
                            <i th:each="i : ${#numbers.sequence(1, 5)}"
                               th:classappend="${i <= rating.rating} ? 'bi bi-star-fill text-warning' : 'bi bi-star text-muted'">
                            </i>
                        </div>
                    </div>
                </div>

                <div class="rating-body mt-2">
                    <div th:if="${rating.comment != null && !rating.comment.isEmpty()}"
                         class="rating-comment">
                        <p class="mb-0" th:text="${rating.comment}"></p>
                    </div>
                </div>

                <!-- Действия для собственных оценок -->
                <div th:if="${#authorization.expression('isAuthenticated()') && rating.user.id == currentUser.id}"
                     class="rating-actions mt-2">
                    <button class="btn btn-sm btn-outline-primary edit-rating"
                            th:attr="data-rating-id=${rating.id}">
                        <i class="bi bi-pencil me-1"></i>Редактировать
                    </button>
                    <button class="btn btn-sm btn-outline-danger delete-rating"
                            th:attr="data-rating-id=${rating.id}">
                        <i class="bi bi-trash me-1"></i>Удалить
                    </button>
                </div>
            </div>

            <!-- Пагинация -->
            <div th:if="${totalPages > 1}" class="pagination-container">
                <nav aria-label="Page navigation">
                    <ul class="pagination justify-content-center">
                        <li th:classappend="${currentPage == 0} ? 'disabled' : ''" class="page-item">
                            <button class="page-link"
                                    th:attr="onclick=${currentPage > 0} ? 'loadRatingsPage(' + (currentPage - 1) + ')' : ''"
                                    th:disabled="${currentPage == 0}">
                                <i class="bi bi-chevron-left"></i>
                            </button>
                        </li>

                        <li th:each="pageNum : ${#numbers.sequence(0, totalPages - 1)}"
                            th:classappend="${currentPage == pageNum} ? 'active' : ''"
                            class="page-item">
                            <button class="page-link"
                                    th:attr="onclick=${currentPage != pageNum} ? 'loadRatingsPage(' + pageNum + ')' : ''"
                                    th:text="${pageNum + 1}">
                            </button>
                        </li>

                        <li th:classappend="${currentPage + 1 == totalPages} ? 'disabled' : ''" class="page-item">
                            <button class="page-link"
                                    th:attr="onclick=${currentPage + 1 < totalPages} ? 'loadRatingsPage(' + (currentPage + 1) + ')' : ''"
                                    th:disabled="${currentPage + 1 == totalPages}">
                                <i class="bi bi-chevron-right"></i>
                            </button>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</div>

</body>
</html>